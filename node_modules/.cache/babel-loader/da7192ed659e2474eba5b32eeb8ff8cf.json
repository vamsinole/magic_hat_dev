{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _slicedToArray from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _wrapNativeSuper from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\nimport _classCallCheck from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _regeneratorRuntime from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/regenerator/index.js\";\nimport { Duplex } from 'readable-stream';\nimport { randomId } from '@toruslabs/openlogin-utils';\nimport { EventEmitter } from 'events';\nimport stringify from 'fast-safe-stringify';\nimport eos from 'end-of-stream';\nimport once from 'once';\nimport pump from 'pump';\n\nfunction noop() {\n  return undefined;\n}\n\nvar SYN = \"SYN\";\nvar ACK = \"ACK\";\nvar BRK = \"BRK\";\n\nvar BasePostMessageStream = /*#__PURE__*/function (_Duplex) {\n  _inherits(BasePostMessageStream, _Duplex);\n\n  var _super = _createSuper(BasePostMessageStream);\n\n  function BasePostMessageStream(_ref) {\n    var _this;\n\n    var name = _ref.name,\n        target = _ref.target,\n        _ref$targetWindow = _ref.targetWindow,\n        targetWindow = _ref$targetWindow === void 0 ? window : _ref$targetWindow,\n        _ref$targetOrigin = _ref.targetOrigin,\n        targetOrigin = _ref$targetOrigin === void 0 ? \"*\" : _ref$targetOrigin;\n\n    _classCallCheck(this, BasePostMessageStream);\n\n    _this = _super.call(this, {\n      objectMode: true\n    });\n\n    if (!name || !target) {\n      throw new Error(\"Invalid input.\");\n    }\n\n    _this._init = false;\n    _this._haveSyn = false;\n    _this._name = name;\n    _this._target = target; // target origin\n\n    _this._targetWindow = targetWindow;\n    _this._targetOrigin = targetOrigin;\n    _this._onMessage = _this.onMessage.bind(_assertThisInitialized(_this));\n    _this._synIntervalId = null;\n    window.addEventListener(\"message\", _this._onMessage, false);\n\n    _this._handShake();\n\n    return _this;\n  }\n\n  _createClass(BasePostMessageStream, [{\n    key: \"_break\",\n    value: function _break() {\n      this.cork();\n\n      this._write(BRK, null, noop);\n\n      this._haveSyn = false;\n      this._init = false;\n    }\n  }, {\n    key: \"_handShake\",\n    value: function _handShake() {\n      this._write(SYN, null, noop);\n\n      this.cork();\n    }\n  }, {\n    key: \"_onData\",\n    value: function _onData(data) {\n      if (!this._init) {\n        // listen for handshake\n        if (data === SYN) {\n          this._haveSyn = true;\n\n          this._write(ACK, null, noop);\n        } else if (data === ACK) {\n          this._init = true;\n\n          if (!this._haveSyn) {\n            this._write(ACK, null, noop);\n          }\n\n          this.uncork();\n        }\n      } else if (data === BRK) {\n        this._break();\n      } else {\n        // forward message\n        try {\n          this.push(data);\n        } catch (err) {\n          this.emit(\"error\", err);\n        }\n      }\n    }\n  }, {\n    key: \"_postMessage\",\n    value: function _postMessage(data) {\n      var originConstraint = this._targetOrigin;\n\n      this._targetWindow.postMessage({\n        target: this._target,\n        data: data\n      }, originConstraint);\n    }\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(event) {\n      var message = event.data; // validate message\n\n      if (this._targetOrigin !== \"*\" && event.origin !== this._targetOrigin || event.source !== this._targetWindow || typeof message !== \"object\" || message.target !== this._name || !message.data) {\n        return;\n      }\n\n      this._onData(message.data);\n    }\n  }, {\n    key: \"_read\",\n    value: function _read() {\n      return undefined;\n    }\n  }, {\n    key: \"_write\",\n    value: function _write(data, _, cb) {\n      this._postMessage(data);\n\n      cb();\n    }\n  }, {\n    key: \"_destroy\",\n    value: function _destroy() {\n      window.removeEventListener(\"message\", this._onMessage, false);\n    }\n  }]);\n\n  return BasePostMessageStream;\n}(Duplex);\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction safeApply(handler, context, args) {\n  try {\n    Reflect.apply(handler, context, args);\n  } catch (err) {\n    // Throw error after timeout so as not to interrupt the stack\n    setTimeout(function () {\n      throw err;\n    });\n  }\n}\n\nfunction arrayClone(arr) {\n  var n = arr.length;\n  var copy = new Array(n);\n\n  for (var i = 0; i < n; i += 1) {\n    copy[i] = arr[i];\n  }\n\n  return copy;\n}\n\nvar SafeEventEmitter = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(SafeEventEmitter, _EventEmitter);\n\n  var _super2 = _createSuper(SafeEventEmitter);\n\n  function SafeEventEmitter() {\n    _classCallCheck(this, SafeEventEmitter);\n\n    return _super2.apply(this, arguments);\n  }\n\n  _createClass(SafeEventEmitter, [{\n    key: \"emit\",\n    value: function emit(type) {\n      var doError = type === \"error\";\n      var events = this._events;\n\n      if (events !== undefined) {\n        doError = doError && events.error === undefined;\n      } else if (!doError) {\n        return false;\n      } // If there is no 'error' event listener then throw.\n\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      if (doError) {\n        var er;\n\n        if (args.length > 0) {\n          er = args[0];\n        }\n\n        if (er instanceof Error) {\n          // Note: The comments on the `throw` lines are intentional, they show\n          // up in Node's output if this results in an unhandled exception.\n          throw er; // Unhandled 'error' event\n        } // At least give some kind of context to the user\n\n\n        var err = new Error(\"Unhandled error.\".concat(er ? \" (\".concat(er.message, \")\") : \"\"));\n        err.context = er;\n        throw err; // Unhandled 'error' event\n      }\n\n      var handler = events[type];\n\n      if (handler === undefined) {\n        return false;\n      }\n\n      if (typeof handler === \"function\") {\n        safeApply(handler, this, args);\n      } else {\n        var len = handler.length;\n        var listeners = arrayClone(handler);\n\n        for (var i = 0; i < len; i += 1) {\n          safeApply(listeners[i], this, args);\n        }\n      }\n\n      return true;\n    }\n  }]);\n\n  return SafeEventEmitter;\n}(EventEmitter);\n\nvar SerializableError = /*#__PURE__*/function (_Error) {\n  _inherits(SerializableError, _Error);\n\n  var _super3 = _createSuper(SerializableError);\n\n  function SerializableError(_ref2) {\n    var _this2;\n\n    var code = _ref2.code,\n        message = _ref2.message,\n        data = _ref2.data;\n\n    _classCallCheck(this, SerializableError);\n\n    if (!Number.isInteger(code)) {\n      throw new Error(\"code must be an integer\");\n    }\n\n    if (!message || typeof message !== \"string\") {\n      throw new Error(\"message must be string\");\n    }\n\n    _this2 = _super3.call(this, message);\n    _this2.code = code;\n\n    if (data !== undefined) {\n      _this2.data = data;\n    }\n\n    return _this2;\n  }\n\n  _createClass(SerializableError, [{\n    key: \"toString\",\n    value: function toString() {\n      return stringify({\n        code: this.code,\n        message: this.message,\n        data: this.data,\n        stack: this.stack\n      });\n    }\n  }]);\n\n  return SerializableError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nfunction serializeError(error) {\n  return error.toString();\n}\n\nvar getRpcPromiseCallback = function getRpcPromiseCallback(resolve, reject) {\n  var unwrapResult = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (error, response) {\n    if (error || response.error) {\n      reject(error || response.error);\n    } else if (!unwrapResult || Array.isArray(response)) {\n      resolve(response);\n    } else {\n      resolve(response.result);\n    }\n  };\n};\n\nfunction createErrorMiddleware(log) {\n  return function (req, res, next, end) {\n    try {\n      // json-rpc-engine will terminate the request when it notices this error\n      if (typeof req.method !== \"string\" || !req.method) {\n        res.error = new SerializableError({\n          code: -32603,\n          message: \"invalid method\"\n        });\n        end();\n        return;\n      }\n\n      next(function (done) {\n        var error = res.error;\n\n        if (!error) {\n          return done();\n        }\n\n        log.error(\"OpenLogin - RPC Error: \".concat(error.message), error);\n        return done();\n      });\n    } catch (error) {\n      log.error(\"OpenLogin - RPC Error thrown: \".concat(error.message), error);\n      res.error = new SerializableError({\n        code: -32603,\n        message: error.message\n      });\n      end();\n    }\n  };\n}\n\nfunction createStreamMiddleware() {\n  var idMap = {};\n\n  function readNoop() {\n    return false;\n  }\n\n  var events = new SafeEventEmitter();\n\n  function processResponse(res) {\n    var context = idMap[res.id];\n\n    if (!context) {\n      throw new Error(\"StreamMiddleware - Unknown response id \\\"\".concat(res.id, \"\\\"\"));\n    }\n\n    delete idMap[res.id]; // copy whole res onto original res\n\n    Object.assign(context.res, res); // run callback on empty stack,\n    // prevent internal stream-handler from catching errors\n\n    setTimeout(context.end);\n  }\n\n  function processNotification(res) {\n    events.emit(\"notification\", res);\n  }\n\n  function processMessage(res, _encoding, cb) {\n    var err;\n\n    try {\n      var isNotification = !res.id;\n\n      if (isNotification) {\n        processNotification(res);\n      } else {\n        processResponse(res);\n      }\n    } catch (_err) {\n      err = _err;\n    } // continue processing stream\n\n\n    cb(err);\n  }\n\n  var stream = new Duplex({\n    objectMode: true,\n    read: readNoop,\n    write: processMessage\n  });\n\n  var middleware = function middleware(req, res, next, end) {\n    // write req to stream\n    stream.push(req); // register request on id map\n\n    idMap[req.id] = {\n      req: req,\n      res: res,\n      next: next,\n      end: end\n    };\n  };\n\n  return {\n    events: events,\n    middleware: middleware,\n    stream: stream\n  };\n}\n\nfunction createScaffoldMiddleware(handlers) {\n  return function (req, res, next, end) {\n    var handler = handlers[req.method]; // if no handler, return\n\n    if (handler === undefined) {\n      return next();\n    } // if handler is fn, call as middleware\n\n\n    if (typeof handler === \"function\") {\n      return handler(req, res, next, end);\n    } // if handler is some other value, use as result\n\n\n    res.result = handler;\n    return end();\n  };\n}\n\nfunction createIdRemapMiddleware() {\n  return function (req, res, next, _end) {\n    var originalId = req.id;\n    var newId = randomId();\n    req.id = newId;\n    res.id = newId;\n    next(function (done) {\n      req.id = originalId;\n      res.id = originalId;\n      done();\n    });\n  };\n}\n\nfunction createLoggerMiddleware(logger) {\n  return function (req, res, next, _) {\n    logger.debug(\"REQ\", req, \"RES\", res);\n    next();\n  };\n}\n\nfunction createAsyncMiddleware(asyncMiddleware) {\n  var _this3 = this;\n\n  return function (req, res, next, end) {\n    return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this4 = this;\n\n      var resolveNextPromise, nextPromise, returnHandlerCallback, nextWasCalled, asyncNext;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              // nextPromise is the key to the implementation\n              // it is resolved by the return handler passed to the\n              // \"next\" function\n              nextPromise = new Promise(function (resolve) {\n                resolveNextPromise = resolve;\n              });\n              returnHandlerCallback = null;\n              nextWasCalled = false; // This will be called by the consumer's async middleware.\n\n              asyncNext = function asyncNext() {\n                return __awaiter(_this4, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          nextWasCalled = true; // We pass a return handler to next(). When it is called by the engine,\n                          // the consumer's async middleware will resume executing.\n\n                          next(function (runReturnHandlersCallback) {\n                            // This callback comes from JRPCEngine._runReturnHandlers\n                            returnHandlerCallback = runReturnHandlersCallback;\n                            resolveNextPromise();\n                          });\n                          _context.next = 4;\n                          return nextPromise;\n\n                        case 4:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n              };\n\n              _context2.prev = 4;\n              _context2.next = 7;\n              return asyncMiddleware(req, res, asyncNext);\n\n            case 7:\n              if (!nextWasCalled) {\n                _context2.next = 13;\n                break;\n              }\n\n              _context2.next = 10;\n              return nextPromise;\n\n            case 10:\n              // we must wait until the return handler is called\n              returnHandlerCallback(null);\n              _context2.next = 14;\n              break;\n\n            case 13:\n              end(null);\n\n            case 14:\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](4);\n\n              if (returnHandlerCallback) {\n                returnHandlerCallback(_context2.t0);\n              } else {\n                end(_context2.t0);\n              }\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 16]]);\n    }));\n  };\n}\n/**\n * A JSON-RPC request and response processor.\n * Give it a stack of middleware, pass it requests, and get back responses.\n */\n\n\nvar JRPCEngine = /*#__PURE__*/function (_SafeEventEmitter) {\n  _inherits(JRPCEngine, _SafeEventEmitter);\n\n  var _super4 = _createSuper(JRPCEngine);\n\n  function JRPCEngine() {\n    var _this5;\n\n    _classCallCheck(this, JRPCEngine);\n\n    _this5 = _super4.call(this);\n    _this5._middleware = [];\n    return _this5;\n  }\n  /**\n   * Serially executes the given stack of middleware.\n   *\n   * @returns An array of any error encountered during middleware execution,\n   * a boolean indicating whether the request was completed, and an array of\n   * middleware-defined return handlers.\n   */\n\n\n  _createClass(JRPCEngine, [{\n    key: \"push\",\n    value:\n    /**\n     * Add a middleware function to the engine's middleware stack.\n     *\n     * @param middleware - The middleware function to add.\n     */\n    function push(middleware) {\n      this._middleware.push(middleware);\n    }\n  }, {\n    key: \"handle\",\n    value: function handle(req, cb) {\n      if (cb && typeof cb !== \"function\") {\n        throw new Error('\"callback\" must be a function if provided.');\n      }\n\n      if (Array.isArray(req)) {\n        if (cb) {\n          return this._handleBatch(req, cb);\n        }\n\n        return this._handleBatch(req);\n      }\n\n      if (cb) {\n        return this._handle(req, cb);\n      }\n\n      return this._promiseHandle(req);\n    }\n    /**\n     * Returns this engine as a middleware function that can be pushed to other\n     * engines.\n     *\n     * @returns This engine as a middleware function.\n     */\n\n  }, {\n    key: \"asMiddleware\",\n    value: function asMiddleware() {\n      var _this6 = this;\n\n      return function (req, res, next, end) {\n        return __awaiter(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n          var _this7 = this;\n\n          var _yield$JRPCEngine$_ru, _yield$JRPCEngine$_ru2, middlewareError, isComplete, returnHandlers;\n\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.prev = 0;\n                  _context4.next = 3;\n                  return JRPCEngine._runAllMiddleware(req, res, this._middleware);\n\n                case 3:\n                  _yield$JRPCEngine$_ru = _context4.sent;\n                  _yield$JRPCEngine$_ru2 = _slicedToArray(_yield$JRPCEngine$_ru, 3);\n                  middlewareError = _yield$JRPCEngine$_ru2[0];\n                  isComplete = _yield$JRPCEngine$_ru2[1];\n                  returnHandlers = _yield$JRPCEngine$_ru2[2];\n\n                  if (!isComplete) {\n                    _context4.next = 12;\n                    break;\n                  }\n\n                  _context4.next = 11;\n                  return JRPCEngine._runReturnHandlers(returnHandlers);\n\n                case 11:\n                  return _context4.abrupt(\"return\", end(middlewareError));\n\n                case 12:\n                  return _context4.abrupt(\"return\", next(function (handlerCallback) {\n                    return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                        while (1) {\n                          switch (_context3.prev = _context3.next) {\n                            case 0:\n                              _context3.prev = 0;\n                              _context3.next = 3;\n                              return JRPCEngine._runReturnHandlers(returnHandlers);\n\n                            case 3:\n                              _context3.next = 8;\n                              break;\n\n                            case 5:\n                              _context3.prev = 5;\n                              _context3.t0 = _context3[\"catch\"](0);\n                              return _context3.abrupt(\"return\", handlerCallback(_context3.t0));\n\n                            case 8:\n                              return _context3.abrupt(\"return\", handlerCallback());\n\n                            case 9:\n                            case \"end\":\n                              return _context3.stop();\n                          }\n                        }\n                      }, _callee3, null, [[0, 5]]);\n                    }));\n                  }));\n\n                case 15:\n                  _context4.prev = 15;\n                  _context4.t0 = _context4[\"catch\"](0);\n                  return _context4.abrupt(\"return\", end(_context4.t0));\n\n                case 18:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4, this, [[0, 15]]);\n        }));\n      };\n    }\n  }, {\n    key: \"_handleBatch\",\n    value: function _handleBatch(reqs, cb) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var responses;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n                _context5.next = 3;\n                return Promise.all( // 1. Begin executing each request in the order received\n                reqs.map(this._promiseHandle.bind(this)));\n\n              case 3:\n                responses = _context5.sent;\n\n                if (!cb) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", cb(null, responses));\n\n              case 6:\n                return _context5.abrupt(\"return\", responses);\n\n              case 9:\n                _context5.prev = 9;\n                _context5.t0 = _context5[\"catch\"](0);\n\n                if (!cb) {\n                  _context5.next = 13;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", cb(_context5.t0));\n\n              case 13:\n                throw _context5.t0;\n\n              case 14:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[0, 9]]);\n      }));\n    }\n    /**\n     * A promise-wrapped _handle.\n     */\n\n  }, {\n    key: \"_promiseHandle\",\n    value: function _promiseHandle(req) {\n      var _this8 = this;\n\n      return new Promise(function (resolve) {\n        _this8._handle(req, function (_err, res) {\n          // There will always be a response, and it will always have any error\n          // that is caught and propagated.\n          resolve(res);\n        });\n      });\n    }\n    /**\n     * Ensures that the request object is valid, processes it, and passes any\n     * error and the response object to the given callback.\n     *\n     * Does not reject.\n     */\n\n  }, {\n    key: \"_handle\",\n    value: function _handle(callerReq, cb) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var _error2, _error3, req, res, error;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(!callerReq || Array.isArray(callerReq) || typeof callerReq !== \"object\")) {\n                  _context6.next = 3;\n                  break;\n                }\n\n                _error2 = new SerializableError({\n                  code: -32603,\n                  message: \"request must be plain object\"\n                });\n                return _context6.abrupt(\"return\", cb(_error2, {\n                  id: undefined,\n                  jsonrpc: \"2.0\",\n                  error: _error2\n                }));\n\n              case 3:\n                if (!(typeof callerReq.method !== \"string\")) {\n                  _context6.next = 6;\n                  break;\n                }\n\n                _error3 = new SerializableError({\n                  code: -32603,\n                  message: \"method must be string\"\n                });\n                return _context6.abrupt(\"return\", cb(_error3, {\n                  id: callerReq.id,\n                  jsonrpc: \"2.0\",\n                  error: _error3\n                }));\n\n              case 6:\n                req = Object.assign({}, callerReq);\n                res = {\n                  id: req.id,\n                  jsonrpc: req.jsonrpc\n                };\n                error = null;\n                _context6.prev = 9;\n                _context6.next = 12;\n                return this._processRequest(req, res);\n\n              case 12:\n                _context6.next = 17;\n                break;\n\n              case 14:\n                _context6.prev = 14;\n                _context6.t0 = _context6[\"catch\"](9);\n                // A request handler error, a re-thrown middleware error, or something\n                // unexpected.\n                error = _context6.t0;\n\n              case 17:\n                if (error) {\n                  // Ensure no result is present on an errored response\n                  delete res.result;\n\n                  if (!res.error) {\n                    res.error = serializeError(error);\n                  }\n                }\n\n                return _context6.abrupt(\"return\", cb(error, res));\n\n              case 19:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[9, 14]]);\n      }));\n    }\n    /**\n     * For the given request and response, runs all middleware and their return\n     * handlers, if any, and ensures that internal request processing semantics\n     * are satisfied.\n     */\n\n  }, {\n    key: \"_processRequest\",\n    value: function _processRequest(req, res) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        var _yield$JRPCEngine$_ru3, _yield$JRPCEngine$_ru4, error, isComplete, returnHandlers;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return JRPCEngine._runAllMiddleware(req, res, this._middleware);\n\n              case 2:\n                _yield$JRPCEngine$_ru3 = _context7.sent;\n                _yield$JRPCEngine$_ru4 = _slicedToArray(_yield$JRPCEngine$_ru3, 3);\n                error = _yield$JRPCEngine$_ru4[0];\n                isComplete = _yield$JRPCEngine$_ru4[1];\n                returnHandlers = _yield$JRPCEngine$_ru4[2];\n\n                // Throw if \"end\" was not called, or if the response has neither a result\n                // nor an error.\n                JRPCEngine._checkForCompletion(req, res, isComplete); // The return handlers should run even if an error was encountered during\n                // middleware processing.\n\n\n                _context7.next = 10;\n                return JRPCEngine._runReturnHandlers(returnHandlers);\n\n              case 10:\n                if (!error) {\n                  _context7.next = 12;\n                  break;\n                }\n\n                throw error;\n\n              case 12:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n    }\n  }], [{\n    key: \"_runAllMiddleware\",\n    value: function _runAllMiddleware(req, res, middlewareStack) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        var returnHandlers, error, isComplete, _iterator, _step, middleware, _yield$JRPCEngine$_ru5, _yield$JRPCEngine$_ru6;\n\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                returnHandlers = [];\n                error = null;\n                isComplete = false; // Go down stack of middleware, call and collect optional returnHandlers\n\n                _iterator = _createForOfIteratorHelper(middlewareStack);\n                _context8.prev = 4;\n\n                _iterator.s();\n\n              case 6:\n                if ((_step = _iterator.n()).done) {\n                  _context8.next = 18;\n                  break;\n                }\n\n                middleware = _step.value;\n                _context8.next = 10;\n                return JRPCEngine._runMiddleware(req, res, middleware, returnHandlers);\n\n              case 10:\n                _yield$JRPCEngine$_ru5 = _context8.sent;\n                _yield$JRPCEngine$_ru6 = _slicedToArray(_yield$JRPCEngine$_ru5, 2);\n                error = _yield$JRPCEngine$_ru6[0];\n                isComplete = _yield$JRPCEngine$_ru6[1];\n\n                if (!isComplete) {\n                  _context8.next = 16;\n                  break;\n                }\n\n                return _context8.abrupt(\"break\", 18);\n\n              case 16:\n                _context8.next = 6;\n                break;\n\n              case 18:\n                _context8.next = 23;\n                break;\n\n              case 20:\n                _context8.prev = 20;\n                _context8.t0 = _context8[\"catch\"](4);\n\n                _iterator.e(_context8.t0);\n\n              case 23:\n                _context8.prev = 23;\n\n                _iterator.f();\n\n                return _context8.finish(23);\n\n              case 26:\n                return _context8.abrupt(\"return\", [error, isComplete, returnHandlers.reverse()]);\n\n              case 27:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, null, [[4, 20, 23, 26]]);\n      }));\n    }\n    /**\n     * Runs an individual middleware.\n     *\n     * @returns An array of any error encountered during middleware exection,\n     * and a boolean indicating whether the request should end.\n     */\n\n  }, {\n    key: \"_runMiddleware\",\n    value: function _runMiddleware(req, res, middleware, returnHandlers) {\n      return new Promise(function (resolve) {\n        var end = function end(err) {\n          var error = err || res.error;\n\n          if (error) {\n            res.error = serializeError(error);\n          } // True indicates that the request should end\n\n\n          resolve([error, true]);\n        };\n\n        var next = function next(returnHandler) {\n          if (res.error) {\n            end(res.error);\n          } else {\n            if (returnHandler) {\n              if (typeof returnHandler !== \"function\") {\n                end(new SerializableError({\n                  code: -32603,\n                  message: \"JRPCEngine: 'next' return handlers must be functions\"\n                }));\n              }\n\n              returnHandlers.push(returnHandler);\n            } // False indicates that the request should not end\n\n\n            resolve([null, false]);\n          }\n        };\n\n        try {\n          middleware(req, res, next, end);\n        } catch (error) {\n          end(error);\n        }\n      });\n    }\n    /**\n     * Serially executes array of return handlers. The request and response are\n     * assumed to be in their scope.\n     */\n\n  }, {\n    key: \"_runReturnHandlers\",\n    value: function _runReturnHandlers(handlers) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n        var _iterator2, _step2, _loop;\n\n        return _regeneratorRuntime.wrap(function _callee9$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _iterator2 = _createForOfIteratorHelper(handlers);\n                _context10.prev = 1;\n                _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n                  var handler;\n                  return _regeneratorRuntime.wrap(function _loop$(_context9) {\n                    while (1) {\n                      switch (_context9.prev = _context9.next) {\n                        case 0:\n                          handler = _step2.value;\n                          _context9.next = 3;\n                          return new Promise(function (resolve, reject) {\n                            handler(function (err) {\n                              return err ? reject(err) : resolve();\n                            });\n                          });\n\n                        case 3:\n                        case \"end\":\n                          return _context9.stop();\n                      }\n                    }\n                  }, _loop);\n                });\n\n                _iterator2.s();\n\n              case 4:\n                if ((_step2 = _iterator2.n()).done) {\n                  _context10.next = 8;\n                  break;\n                }\n\n                return _context10.delegateYield(_loop(), \"t0\", 6);\n\n              case 6:\n                _context10.next = 4;\n                break;\n\n              case 8:\n                _context10.next = 13;\n                break;\n\n              case 10:\n                _context10.prev = 10;\n                _context10.t1 = _context10[\"catch\"](1);\n\n                _iterator2.e(_context10.t1);\n\n              case 13:\n                _context10.prev = 13;\n\n                _iterator2.f();\n\n                return _context10.finish(13);\n\n              case 16:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee9, null, [[1, 10, 13, 16]]);\n      }));\n    }\n    /**\n     * Throws an error if the response has neither a result nor an error, or if\n     * the \"isComplete\" flag is falsy.\n     */\n\n  }, {\n    key: \"_checkForCompletion\",\n    value: function _checkForCompletion(req, res, isComplete) {\n      if (!(\"result\" in res) && !(\"error\" in res)) {\n        throw new SerializableError({\n          code: -32603,\n          message: \"Response has no error or result for request\"\n        });\n      }\n\n      if (!isComplete) {\n        throw new SerializableError({\n          code: -32603,\n          message: \"Nothing ended request\"\n        });\n      }\n    }\n  }]);\n\n  return JRPCEngine;\n}(SafeEventEmitter);\n\nfunction mergeMiddleware(middlewareStack) {\n  var engine = new JRPCEngine();\n  middlewareStack.forEach(function (middleware) {\n    return engine.push(middleware);\n  });\n  return engine.asMiddleware();\n}\n\nfunction createEngineStream(opts) {\n  if (!opts || !opts.engine) {\n    throw new Error(\"Missing engine parameter!\");\n  }\n\n  var engine = opts.engine; // eslint-disable-next-line prefer-const\n\n  var stream;\n\n  function read() {\n    return undefined;\n  }\n\n  function write(req, _encoding, cb) {\n    engine.handle(req, function (_err, res) {\n      stream.push(res);\n    });\n    cb();\n  }\n\n  stream = new Duplex({\n    objectMode: true,\n    read: read,\n    write: write\n  }); // forward notifications\n\n  if (engine.on) {\n    engine.on(\"notification\", function (message) {\n      stream.push(message);\n    });\n  }\n\n  return stream;\n}\n\nvar Substream = /*#__PURE__*/function (_Duplex2) {\n  _inherits(Substream, _Duplex2);\n\n  var _super5 = _createSuper(Substream);\n\n  function Substream(_ref3) {\n    var _this9;\n\n    var parent = _ref3.parent,\n        name = _ref3.name;\n\n    _classCallCheck(this, Substream);\n\n    _this9 = _super5.call(this, {\n      objectMode: true\n    });\n    _this9._parent = parent;\n    _this9._name = name;\n    return _this9;\n  }\n  /**\n   * Explicitly sets read operations to a no-op.\n   */\n\n\n  _createClass(Substream, [{\n    key: \"_read\",\n    value: function _read() {\n      return undefined;\n    }\n    /**\n     * Called when data should be written to this writable stream.\n     *\n     * @param chunk - Arbitrary object to write\n     * @param encoding - Encoding to use when writing payload\n     * @param callback - Called when writing is complete or an error occurs\n     */\n\n  }, {\n    key: \"_write\",\n    value: function _write(chunk, _encoding, callback) {\n      this._parent.push({\n        name: this._name,\n        data: chunk\n      });\n\n      callback();\n    }\n  }]);\n\n  return Substream;\n}(Duplex);\n\nvar IGNORE_SUBSTREAM = Symbol(\"IGNORE_SUBSTREAM\");\n\nvar ObjectMultiplex = /*#__PURE__*/function (_Duplex3) {\n  _inherits(ObjectMultiplex, _Duplex3);\n\n  var _super6 = _createSuper(ObjectMultiplex);\n\n  function ObjectMultiplex() {\n    var _this10;\n\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ObjectMultiplex);\n\n    _this10 = _super6.call(this, Object.assign(Object.assign({}, opts), {\n      objectMode: true\n    }));\n    _this10._substreams = {};\n    return _this10;\n  }\n\n  _createClass(ObjectMultiplex, [{\n    key: \"createStream\",\n    value: function createStream(name) {\n      // validate name\n      if (!name) {\n        throw new Error(\"ObjectMultiplex - name must not be empty\");\n      }\n\n      if (this._substreams[name]) {\n        throw new Error(\"ObjectMultiplex - Substream for name \\\"\".concat(name, \"\\\" already exists\"));\n      } // create substream\n\n\n      var substream = new Substream({\n        parent: this,\n        name: name\n      });\n      this._substreams[name] = substream; // listen for parent stream to end\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n      anyStreamEnd(this, function (_error) {\n        return substream.destroy(_error || undefined);\n      });\n      return substream;\n    } // ignore streams (dont display orphaned data warning)\n\n  }, {\n    key: \"ignoreStream\",\n    value: function ignoreStream(name) {\n      // validate name\n      if (!name) {\n        throw new Error(\"ObjectMultiplex - name must not be empty\");\n      }\n\n      if (this._substreams[name]) {\n        throw new Error(\"ObjectMultiplex - Substream for name \\\"\".concat(name, \"\\\" already exists\"));\n      } // set\n\n\n      this._substreams[name] = IGNORE_SUBSTREAM;\n    }\n  }, {\n    key: \"_read\",\n    value: function _read() {\n      return undefined;\n    }\n  }, {\n    key: \"_write\",\n    value: function _write(chunk, _encoding, callback) {\n      var name = chunk.name,\n          data = chunk.data;\n\n      if (!name) {\n        window.console.warn(\"ObjectMultiplex - malformed chunk without name \\\"\".concat(chunk, \"\\\"\"));\n        return callback();\n      } // get corresponding substream\n\n\n      var substream = this._substreams[name];\n\n      if (!substream) {\n        window.console.warn(\"ObjectMultiplex - orphaned data for stream \\\"\".concat(name, \"\\\"\"));\n        return callback();\n      } // push data into substream\n\n\n      if (substream !== IGNORE_SUBSTREAM) {\n        substream.push(data);\n      }\n\n      return callback();\n    }\n  }]);\n\n  return ObjectMultiplex;\n}(Duplex); // util\n\n\nfunction anyStreamEnd(stream, _cb) {\n  var cb = once(_cb);\n  eos(stream, {\n    readable: false\n  }, cb);\n  eos(stream, {\n    writable: false\n  }, cb);\n}\n\nfunction setupMultiplex(stream) {\n  var mux = new ObjectMultiplex();\n\n  mux.getStream = function streamHelper(name) {\n    if (this._substreams[name]) {\n      return this._substreams[name];\n    }\n\n    return this.createStream(name);\n  };\n\n  pump(stream, mux, stream, function (err) {\n    if (err) window.console.error(err);\n  });\n  return mux;\n}\n\nvar PostMessageStream = /*#__PURE__*/function (_BasePostMessageStrea) {\n  _inherits(PostMessageStream, _BasePostMessageStrea);\n\n  var _super7 = _createSuper(PostMessageStream);\n\n  function PostMessageStream() {\n    _classCallCheck(this, PostMessageStream);\n\n    return _super7.apply(this, arguments);\n  }\n\n  _createClass(PostMessageStream, [{\n    key: \"_postMessage\",\n    value: function _postMessage(data) {\n      var originConstraint = this._targetOrigin;\n\n      if (typeof data === \"object\") {\n        var dataObj = data;\n\n        if (typeof dataObj.data === \"object\") {\n          var dataObjData = dataObj.data;\n\n          if (Array.isArray(dataObjData.params) && dataObjData.params.length > 0) {\n            var dataObjDataParam = dataObjData.params[0];\n\n            if (dataObjDataParam._origin) {\n              originConstraint = dataObjDataParam._origin;\n            } // add a constraint for the response\n\n\n            dataObjDataParam._origin = window.location.origin;\n          }\n        }\n      }\n\n      this._targetWindow.postMessage({\n        target: this._target,\n        data: data\n      }, originConstraint);\n    }\n  }]);\n\n  return PostMessageStream;\n}(BasePostMessageStream);\n\nexport { BasePostMessageStream, IGNORE_SUBSTREAM, JRPCEngine, ObjectMultiplex, PostMessageStream, SafeEventEmitter, SerializableError, Substream, createAsyncMiddleware, createEngineStream, createErrorMiddleware, createIdRemapMiddleware, createLoggerMiddleware, createScaffoldMiddleware, createStreamMiddleware, getRpcPromiseCallback, mergeMiddleware, serializeError, setupMultiplex };","map":{"version":3,"mappings":"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","names":["noop","undefined","SYN","ACK","BRK","BasePostMessageStream","name","target","targetWindow","window","targetOrigin","objectMode","Error","_init","_haveSyn","_name","_target","_targetWindow","_targetOrigin","_onMessage","onMessage","bind","_synIntervalId","addEventListener","_handShake","cork","_write","data","uncork","_break","push","err","emit","originConstraint","postMessage","event","message","origin","source","_onData","_","cb","_postMessage","removeEventListener","Duplex","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","safeApply","handler","context","args","Reflect","setTimeout","arrayClone","arr","n","length","copy","Array","i","SafeEventEmitter","type","doError","events","_events","error","er","len","listeners","EventEmitter","SerializableError","code","Number","isInteger","stringify","stack","serializeError","toString","getRpcPromiseCallback","unwrapResult","response","isArray","createErrorMiddleware","log","req","res","end","method","createStreamMiddleware","idMap","readNoop","processResponse","id","Object","assign","processNotification","processMessage","_encoding","isNotification","_err","stream","read","write","middleware","createScaffoldMiddleware","handlers","createIdRemapMiddleware","_end","originalId","newId","randomId","createLoggerMiddleware","logger","debug","createAsyncMiddleware","asyncMiddleware","nextPromise","resolveNextPromise","returnHandlerCallback","nextWasCalled","asyncNext","runReturnHandlersCallback","JRPCEngine","_middleware","_handleBatch","_handle","_promiseHandle","_runAllMiddleware","middlewareError","isComplete","returnHandlers","_runReturnHandlers","handlerCallback","reqs","all","map","responses","callerReq","jsonrpc","_processRequest","_checkForCompletion","middlewareStack","_runMiddleware","reverse","returnHandler","mergeMiddleware","engine","forEach","asMiddleware","createEngineStream","opts","handle","on","Substream","parent","_parent","chunk","callback","IGNORE_SUBSTREAM","Symbol","ObjectMultiplex","_substreams","substream","anyStreamEnd","_error","destroy","console","warn","_cb","once","eos","readable","writable","setupMultiplex","mux","getStream","streamHelper","createStream","pump","PostMessageStream","dataObj","dataObjData","params","dataObjDataParam","_origin","location"],"sources":["../src/basePostMessageStream.ts","../../../node_modules/tslib/tslib.es6.js","../src/safeEventEmitter.ts","../src/serializableError.ts","../src/jrpc.ts","../src/jrpcEngine.ts","../src/substream.ts","../src/mux.ts","../src/postMessageStream.ts"],"sourcesContent":[null,"/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n",null,null,null,null,null,null,null]},"metadata":{},"sourceType":"module"}