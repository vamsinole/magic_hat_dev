{"ast":null,"code":"import _slicedToArray from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _asyncToGenerator from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _regeneratorRuntime from \"/Users/vamshikrishnaenjapuri/Documents/magic_hat_tshht/node_modules/@babel/runtime/regenerator/index.js\";\nimport BN from \"bn.js\";\nimport { sha256 as sha256Sync } from \"js-sha256\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport { translateAddress } from \"../program/common\"; // Sync version of web3.PublicKey.createWithSeed.\n\nexport function createWithSeedSync(fromPublicKey, seed, programId) {\n  var buffer = Buffer.concat([fromPublicKey.toBuffer(), Buffer.from(seed), programId.toBuffer()]);\n  var hash = sha256Sync.digest(buffer);\n  return new PublicKey(Buffer.from(hash));\n} // Sync version of web3.PublicKey.createProgramAddress.\n\nexport function createProgramAddressSync(seeds, programId) {\n  var MAX_SEED_LENGTH = 32;\n  var buffer = Buffer.alloc(0);\n  seeds.forEach(function (seed) {\n    if (seed.length > MAX_SEED_LENGTH) {\n      throw new TypeError(\"Max seed length exceeded\");\n    }\n\n    buffer = Buffer.concat([buffer, toBuffer(seed)]);\n  });\n  buffer = Buffer.concat([buffer, programId.toBuffer(), Buffer.from(\"ProgramDerivedAddress\")]);\n  var hash = sha256Sync(new Uint8Array(buffer));\n  var publicKeyBytes = new BN(hash, 16).toArray(undefined, 32);\n\n  if (PublicKey.isOnCurve(new Uint8Array(publicKeyBytes))) {\n    throw new Error(\"Invalid seeds, address must fall off the curve\");\n  }\n\n  return new PublicKey(publicKeyBytes);\n} // Sync version of web3.PublicKey.findProgramAddress.\n\nexport function findProgramAddressSync(seeds, programId) {\n  var nonce = 255;\n  var address;\n\n  while (nonce != 0) {\n    try {\n      var seedsWithNonce = seeds.concat(Buffer.from([nonce]));\n      address = createProgramAddressSync(seedsWithNonce, programId);\n    } catch (err) {\n      if (err instanceof TypeError) {\n        throw err;\n      }\n\n      nonce--;\n      continue;\n    }\n\n    return [address, nonce];\n  }\n\n  throw new Error(\"Unable to find a viable program address nonce\");\n}\n\nvar toBuffer = function toBuffer(arr) {\n  if (arr instanceof Buffer) {\n    return arr;\n  } else if (arr instanceof Uint8Array) {\n    return Buffer.from(arr.buffer, arr.byteOffset, arr.byteLength);\n  } else {\n    return Buffer.from(arr);\n  }\n};\n\nexport function associated(_x) {\n  return _associated.apply(this, arguments);\n}\n\nfunction _associated() {\n  _associated = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(programId) {\n    var seeds,\n        _len,\n        args,\n        _key,\n        _yield$PublicKey$find,\n        _yield$PublicKey$find2,\n        assoc,\n        _args = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            seeds = [Buffer.from([97, 110, 99, 104, 111, 114])]; // b\"anchor\".\n\n            for (_len = _args.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n              args[_key - 1] = _args[_key];\n            }\n\n            args.forEach(function (arg) {\n              seeds.push( // @ts-ignore\n              arg.buffer !== undefined ? arg : translateAddress(arg).toBuffer());\n            });\n            _context.next = 5;\n            return PublicKey.findProgramAddress(seeds, translateAddress(programId));\n\n          case 5:\n            _yield$PublicKey$find = _context.sent;\n            _yield$PublicKey$find2 = _slicedToArray(_yield$PublicKey$find, 1);\n            assoc = _yield$PublicKey$find2[0];\n            return _context.abrupt(\"return\", assoc);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _associated.apply(this, arguments);\n}","map":{"version":3,"mappings":"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","names":["BN","sha256","sha256Sync","PublicKey","translateAddress","createWithSeedSync","fromPublicKey","seed","programId","buffer","Buffer","concat","toBuffer","from","hash","digest","createProgramAddressSync","seeds","MAX_SEED_LENGTH","alloc","forEach","length","TypeError","Uint8Array","publicKeyBytes","toArray","undefined","isOnCurve","Error","findProgramAddressSync","nonce","address","seedsWithNonce","err","arr","byteOffset","byteLength","associated","args","arg","push","findProgramAddress","assoc"],"sourceRoot":"","sources":["../../../src/utils/pubkey.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}